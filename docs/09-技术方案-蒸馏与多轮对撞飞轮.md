# 技术方案：蒸馏与多轮对撞飞轮（v1）

## 1. 目标
构建“有限数据条件下可持续改进”的模型迭代机制，使系统兼顾：
- 准确性（Correctness）
- 完整性（Completeness）
- 安全性（Safety）
- 时效性（Timeliness）

## 2. 四步飞轮（核心机制）

### Step 1：Teacher 生成候选样本
- 输入：成分知识、趋势信号、商品信息、弱画像条件。
- 产出：问答样本、推荐解释样本、对抗样本（边界案例）。
- 要点：生成前注入合规约束与证据提示，减少无依据输出。

### Step 2：规则与知识校验
- 校验维度：
  - 合规规则（禁用词/敏感词）
  - 知识一致性（是否与成分知识冲突）
  - 置信度评分（证据覆盖度）
- 处理策略：block / warn / rewrite / drop。
- 产出：可蒸馏样本池（带标签与置信度）。

### Step 3：Student 蒸馏训练
- 训练对象：通过校验的高质量样本。
- 训练策略：
  - 主任务学习（推荐与解释）
  - 回放机制（旧版本样本回放）
- 目标：在提升新知识能力的同时抑制灾难性遗忘。

### Step 4：误差回流（多轮对撞）
- 来源：
  - 评测低分样本
  - 线上失败样本
  - 合规触发样本
- 操作：
  - 归因分类（知识缺失/检索问题/生成问题/规则问题）
  - 转入 hard-case 池
  - 进入下一轮 Teacher 定向生成
- 结果：形成“错误驱动的数据增量”。

## 3. 防遗忘与版本稳定
- 固定回放集：每轮必跑，性能下降不得超过 3%。
- 历史高频问题 Top50：错误新增数为 0。
- 已修复问题复发率：<=2%。

## 4. 迭代节奏（与 SOP 对齐）
- 每两周一轮：
  - D1-D2 预算与范围冻结
  - D3-D6 数据与知识更新
  - D7-D9 蒸馏训练
  - D10 评测
  - D11 灰度
  - D12-D14 复盘回流

## 5. 每轮输入/输出工件

### 输入工件
- `data_budget.yaml`
- `knowledge_pack_vN`
- `hard_cases_vN-1`
- `compliance_rules_vN`

### 输出工件
- `distill_dataset_vN`
- `student_ckpt_vN`
- `eval_report_vN`
- `risk_report_vN`
- `retrospective_vN`

## 6. 评测与放行门槛
- Correctness >= 1.4/2
- Completeness >= 1.2/2
- Safety >= 1.8/2
- 高风险违规输出 = 0
- P95 延迟 <= 5s（MVP）

## 7. 风险与缓解
- 风险：Teacher 幻觉污染蒸馏集
  - 缓解：双重校验（规则 + 知识一致性）
- 风险：趋势词噪声大
  - 缓解：趋势补样比例上限 + 人工抽检
- 风险：快速迭代引发遗忘
  - 缓解：回放集 + 回归门槛硬约束

本方案对应执行规范见：
- `03-两周迭代SOP.md`
- `04-评测与发布门槛.md`
